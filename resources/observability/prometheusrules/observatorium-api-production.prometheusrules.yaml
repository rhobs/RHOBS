---
$schema: /openshift/prometheus-rule-1.yml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  labels:
    prometheus: app-sre
    role: alert-rules
  name: observatorium-api-production
spec:
  groups:
  - name: observatorium-api-write-metrics-errors.slo
    rules:
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="receive",job="observatorium-observatorium-api",code=~"5.."}[1d]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="receive",job="observatorium-observatorium-api"}[1d]))
      labels:
        handler: receive
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate1d
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="receive",job="observatorium-observatorium-api",code=~"5.."}[1h]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="receive",job="observatorium-observatorium-api"}[1h]))
      labels:
        handler: receive
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate1h
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="receive",job="observatorium-observatorium-api",code=~"5.."}[2h]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="receive",job="observatorium-observatorium-api"}[2h]))
      labels:
        handler: receive
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate2h
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="receive",job="observatorium-observatorium-api",code=~"5.."}[30m]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="receive",job="observatorium-observatorium-api"}[30m]))
      labels:
        handler: receive
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate30m
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="receive",job="observatorium-observatorium-api",code=~"5.."}[3d]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="receive",job="observatorium-observatorium-api"}[3d]))
      labels:
        handler: receive
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate3d
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="receive",job="observatorium-observatorium-api",code=~"5.."}[5m]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="receive",job="observatorium-observatorium-api"}[5m]))
      labels:
        handler: receive
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate5m
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="receive",job="observatorium-observatorium-api",code=~"5.."}[6h]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="receive",job="observatorium-observatorium-api"}[6h]))
      labels:
        handler: receive
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate6h
    - alert: ObservatoriumAPIMetricsErrorsSLOBudgetBurn5mand1h
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Tg-mH0rizaSJDKSADX/observatorium-api-write-metrics-errors.slo?orgId=1&refresh=10s&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}&var-job=All&var-pod=All&var-interval=5m
        message: 'High error budget burn for group=metricsv1,handler=receive,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapimetricserrorsslobudgetburn5mand1h
      expr: |
        sum(http_requests_total:burnrate5m{handler="receive",job="observatorium-observatorium-api"}) > (14.40 * (1-0.99000))
        and
        sum(http_requests_total:burnrate1h{handler="receive",job="observatorium-observatorium-api"}) > (14.40 * (1-0.99000))
      for: 2m
      labels:
        handler: receive
        job: observatorium-observatorium-api
        service: telemeter
        severity: critical
    - alert: ObservatoriumAPIMetricsErrorsSLOBudgetBurn30mand6h
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Tg-mH0rizaSJDKSADX/observatorium-api-write-metrics-errors.slo?orgId=1&refresh=10s&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}&var-job=All&var-pod=All&var-interval=5m
        message: 'High error budget burn for group=metricsv1,handler=receive,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapimetricserrorsslobudgetburn30mand6h
      expr: |
        sum(http_requests_total:burnrate30m{handler="receive",job="observatorium-observatorium-api"}) > (6.00 * (1-0.99000))
        and
        sum(http_requests_total:burnrate6h{handler="receive",job="observatorium-observatorium-api"}) > (6.00 * (1-0.99000))
      for: 15m
      labels:
        handler: receive
        job: observatorium-observatorium-api
        service: telemeter
        severity: critical
    - alert: ObservatoriumAPIMetricsErrorsSLOBudgetBurn2hand1d
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Tg-mH0rizaSJDKSADX/observatorium-api-write-metrics-errors.slo?orgId=1&refresh=10s&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}&var-job=All&var-pod=All&var-interval=5m
        message: 'High error budget burn for group=metricsv1,handler=receive,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapimetricserrorsslobudgetburn2hand1d
      expr: |
        sum(http_requests_total:burnrate2h{handler="receive",job="observatorium-observatorium-api"}) > (3.00 * (1-0.99000))
        and
        sum(http_requests_total:burnrate1d{handler="receive",job="observatorium-observatorium-api"}) > (3.00 * (1-0.99000))
      for: 1h
      labels:
        handler: receive
        job: observatorium-observatorium-api
        service: telemeter
        severity: medium
    - alert: ObservatoriumAPIMetricsErrorsSLOBudgetBurn6hand3d
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Tg-mH0rizaSJDKSADX/observatorium-api-write-metrics-errors.slo?orgId=1&refresh=10s&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}&var-job=All&var-pod=All&var-interval=5m
        message: 'High error budget burn for group=metricsv1,handler=receive,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapimetricserrorsslobudgetburn6hand3d
      expr: |
        sum(http_requests_total:burnrate6h{handler="receive",job="observatorium-observatorium-api"}) > (1.00 * (1-0.99000))
        and
        sum(http_requests_total:burnrate3d{handler="receive",job="observatorium-observatorium-api"}) > (1.00 * (1-0.99000))
      for: 3h
      labels:
        handler: receive
        job: observatorium-observatorium-api
        service: telemeter
        severity: medium
  - name: observatorium-api-query-metrics-errors.slo
    rules:
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query",job="observatorium-observatorium-api",code=~"5.."}[1d]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query",job="observatorium-observatorium-api"}[1d]))
      labels:
        handler: query
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate1d
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query",job="observatorium-observatorium-api",code=~"5.."}[1h]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query",job="observatorium-observatorium-api"}[1h]))
      labels:
        handler: query
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate1h
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query",job="observatorium-observatorium-api",code=~"5.."}[2h]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query",job="observatorium-observatorium-api"}[2h]))
      labels:
        handler: query
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate2h
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query",job="observatorium-observatorium-api",code=~"5.."}[30m]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query",job="observatorium-observatorium-api"}[30m]))
      labels:
        handler: query
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate30m
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query",job="observatorium-observatorium-api",code=~"5.."}[3d]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query",job="observatorium-observatorium-api"}[3d]))
      labels:
        handler: query
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate3d
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query",job="observatorium-observatorium-api",code=~"5.."}[5m]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query",job="observatorium-observatorium-api"}[5m]))
      labels:
        handler: query
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate5m
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query",job="observatorium-observatorium-api",code=~"5.."}[6h]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query",job="observatorium-observatorium-api"}[6h]))
      labels:
        handler: query
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate6h
    - alert: ObservatoriumAPIMetricsErrorsSLOBudgetBurn5mand1h
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Tg-mH0rizaSJDKSADX/observatorium-api-query-metrics-errors.slo?orgId=1&refresh=10s&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}&var-job=All&var-pod=All&var-interval=5m
        message: 'High error budget burn for group=metricsv1,handler=query,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapimetricserrorsslobudgetburn5mand1h
      expr: |
        sum(http_requests_total:burnrate5m{handler="query",job="observatorium-observatorium-api"}) > (14.40 * (1-0.95000))
        and
        sum(http_requests_total:burnrate1h{handler="query",job="observatorium-observatorium-api"}) > (14.40 * (1-0.95000))
      for: 2m
      labels:
        handler: query
        job: observatorium-observatorium-api
        service: telemeter
        severity: critical
    - alert: ObservatoriumAPIMetricsErrorsSLOBudgetBurn30mand6h
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Tg-mH0rizaSJDKSADX/observatorium-api-query-metrics-errors.slo?orgId=1&refresh=10s&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}&var-job=All&var-pod=All&var-interval=5m
        message: 'High error budget burn for group=metricsv1,handler=query,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapimetricserrorsslobudgetburn30mand6h
      expr: |
        sum(http_requests_total:burnrate30m{handler="query",job="observatorium-observatorium-api"}) > (6.00 * (1-0.95000))
        and
        sum(http_requests_total:burnrate6h{handler="query",job="observatorium-observatorium-api"}) > (6.00 * (1-0.95000))
      for: 15m
      labels:
        handler: query
        job: observatorium-observatorium-api
        service: telemeter
        severity: critical
    - alert: ObservatoriumAPIMetricsErrorsSLOBudgetBurn2hand1d
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Tg-mH0rizaSJDKSADX/observatorium-api-query-metrics-errors.slo?orgId=1&refresh=10s&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}&var-job=All&var-pod=All&var-interval=5m
        message: 'High error budget burn for group=metricsv1,handler=query,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapimetricserrorsslobudgetburn2hand1d
      expr: |
        sum(http_requests_total:burnrate2h{handler="query",job="observatorium-observatorium-api"}) > (3.00 * (1-0.95000))
        and
        sum(http_requests_total:burnrate1d{handler="query",job="observatorium-observatorium-api"}) > (3.00 * (1-0.95000))
      for: 1h
      labels:
        handler: query
        job: observatorium-observatorium-api
        service: telemeter
        severity: medium
    - alert: ObservatoriumAPIMetricsErrorsSLOBudgetBurn6hand3d
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Tg-mH0rizaSJDKSADX/observatorium-api-query-metrics-errors.slo?orgId=1&refresh=10s&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}&var-job=All&var-pod=All&var-interval=5m
        message: 'High error budget burn for group=metricsv1,handler=query,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapimetricserrorsslobudgetburn6hand3d
      expr: |
        sum(http_requests_total:burnrate6h{handler="query",job="observatorium-observatorium-api"}) > (1.00 * (1-0.95000))
        and
        sum(http_requests_total:burnrate3d{handler="query",job="observatorium-observatorium-api"}) > (1.00 * (1-0.95000))
      for: 3h
      labels:
        handler: query
        job: observatorium-observatorium-api
        service: telemeter
        severity: medium
  - name: observatorium-api-query-legacy-metrics-errors.slo
    rules:
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query_legacy",job="observatorium-observatorium-api",code=~"5.."}[1d]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query_legacy",job="observatorium-observatorium-api"}[1d]))
      labels:
        handler: query_legacy
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate1d
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query_legacy",job="observatorium-observatorium-api",code=~"5.."}[1h]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query_legacy",job="observatorium-observatorium-api"}[1h]))
      labels:
        handler: query_legacy
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate1h
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query_legacy",job="observatorium-observatorium-api",code=~"5.."}[2h]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query_legacy",job="observatorium-observatorium-api"}[2h]))
      labels:
        handler: query_legacy
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate2h
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query_legacy",job="observatorium-observatorium-api",code=~"5.."}[30m]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query_legacy",job="observatorium-observatorium-api"}[30m]))
      labels:
        handler: query_legacy
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate30m
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query_legacy",job="observatorium-observatorium-api",code=~"5.."}[3d]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query_legacy",job="observatorium-observatorium-api"}[3d]))
      labels:
        handler: query_legacy
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate3d
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query_legacy",job="observatorium-observatorium-api",code=~"5.."}[5m]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query_legacy",job="observatorium-observatorium-api"}[5m]))
      labels:
        handler: query_legacy
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate5m
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query_legacy",job="observatorium-observatorium-api",code=~"5.."}[6h]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query_legacy",job="observatorium-observatorium-api"}[6h]))
      labels:
        handler: query_legacy
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate6h
    - alert: ObservatoriumAPIMetricsErrorsSLOBudgetBurn5mand1h
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Tg-mH0rizaSJDKSADX/observatorium-api-query-legacy-metrics-errors.slo?orgId=1&refresh=10s&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}&var-job=All&var-pod=All&var-interval=5m
        message: 'High error budget burn for group=metricsv1,handler=query_legacy,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapimetricserrorsslobudgetburn5mand1h
      expr: |
        sum(http_requests_total:burnrate5m{handler="query_legacy",job="observatorium-observatorium-api"}) > (14.40 * (1-0.95000))
        and
        sum(http_requests_total:burnrate1h{handler="query_legacy",job="observatorium-observatorium-api"}) > (14.40 * (1-0.95000))
      for: 2m
      labels:
        handler: query_legacy
        job: observatorium-observatorium-api
        service: telemeter
        severity: critical
    - alert: ObservatoriumAPIMetricsErrorsSLOBudgetBurn30mand6h
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Tg-mH0rizaSJDKSADX/observatorium-api-query-legacy-metrics-errors.slo?orgId=1&refresh=10s&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}&var-job=All&var-pod=All&var-interval=5m
        message: 'High error budget burn for group=metricsv1,handler=query_legacy,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapimetricserrorsslobudgetburn30mand6h
      expr: |
        sum(http_requests_total:burnrate30m{handler="query_legacy",job="observatorium-observatorium-api"}) > (6.00 * (1-0.95000))
        and
        sum(http_requests_total:burnrate6h{handler="query_legacy",job="observatorium-observatorium-api"}) > (6.00 * (1-0.95000))
      for: 15m
      labels:
        handler: query_legacy
        job: observatorium-observatorium-api
        service: telemeter
        severity: critical
    - alert: ObservatoriumAPIMetricsErrorsSLOBudgetBurn2hand1d
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Tg-mH0rizaSJDKSADX/observatorium-api-query-legacy-metrics-errors.slo?orgId=1&refresh=10s&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}&var-job=All&var-pod=All&var-interval=5m
        message: 'High error budget burn for group=metricsv1,handler=query_legacy,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapimetricserrorsslobudgetburn2hand1d
      expr: |
        sum(http_requests_total:burnrate2h{handler="query_legacy",job="observatorium-observatorium-api"}) > (3.00 * (1-0.95000))
        and
        sum(http_requests_total:burnrate1d{handler="query_legacy",job="observatorium-observatorium-api"}) > (3.00 * (1-0.95000))
      for: 1h
      labels:
        handler: query_legacy
        job: observatorium-observatorium-api
        service: telemeter
        severity: medium
    - alert: ObservatoriumAPIMetricsErrorsSLOBudgetBurn6hand3d
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Tg-mH0rizaSJDKSADX/observatorium-api-query-legacy-metrics-errors.slo?orgId=1&refresh=10s&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}&var-job=All&var-pod=All&var-interval=5m
        message: 'High error budget burn for group=metricsv1,handler=query_legacy,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapimetricserrorsslobudgetburn6hand3d
      expr: |
        sum(http_requests_total:burnrate6h{handler="query_legacy",job="observatorium-observatorium-api"}) > (1.00 * (1-0.95000))
        and
        sum(http_requests_total:burnrate3d{handler="query_legacy",job="observatorium-observatorium-api"}) > (1.00 * (1-0.95000))
      for: 3h
      labels:
        handler: query_legacy
        job: observatorium-observatorium-api
        service: telemeter
        severity: medium
  - name: observatorium-api-query-range-metrics-errors.slo
    rules:
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query_range",job="observatorium-observatorium-api",code=~"5.."}[1d]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query_range",job="observatorium-observatorium-api"}[1d]))
      labels:
        handler: query_range
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate1d
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query_range",job="observatorium-observatorium-api",code=~"5.."}[1h]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query_range",job="observatorium-observatorium-api"}[1h]))
      labels:
        handler: query_range
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate1h
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query_range",job="observatorium-observatorium-api",code=~"5.."}[2h]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query_range",job="observatorium-observatorium-api"}[2h]))
      labels:
        handler: query_range
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate2h
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query_range",job="observatorium-observatorium-api",code=~"5.."}[30m]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query_range",job="observatorium-observatorium-api"}[30m]))
      labels:
        handler: query_range
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate30m
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query_range",job="observatorium-observatorium-api",code=~"5.."}[3d]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query_range",job="observatorium-observatorium-api"}[3d]))
      labels:
        handler: query_range
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate3d
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query_range",job="observatorium-observatorium-api",code=~"5.."}[5m]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query_range",job="observatorium-observatorium-api"}[5m]))
      labels:
        handler: query_range
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate5m
    - expr: |
        sum(rate(http_requests_total{group="metricsv1",handler="query_range",job="observatorium-observatorium-api",code=~"5.."}[6h]))
        /
        sum(rate(http_requests_total{group="metricsv1",handler="query_range",job="observatorium-observatorium-api"}[6h]))
      labels:
        handler: query_range
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate6h
    - alert: ObservatoriumAPIMetricsErrorsSLOBudgetBurn5mand1h
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Tg-mH0rizaSJDKSADX/observatorium-api-query-range-metrics-errors.slo?orgId=1&refresh=10s&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}&var-job=All&var-pod=All&var-interval=5m
        message: 'High error budget burn for group=metricsv1,handler=query_range,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapimetricserrorsslobudgetburn5mand1h
      expr: |
        sum(http_requests_total:burnrate5m{handler="query_range",job="observatorium-observatorium-api"}) > (14.40 * (1-0.90000))
        and
        sum(http_requests_total:burnrate1h{handler="query_range",job="observatorium-observatorium-api"}) > (14.40 * (1-0.90000))
      for: 2m
      labels:
        handler: query_range
        job: observatorium-observatorium-api
        service: telemeter
        severity: critical
    - alert: ObservatoriumAPIMetricsErrorsSLOBudgetBurn30mand6h
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Tg-mH0rizaSJDKSADX/observatorium-api-query-range-metrics-errors.slo?orgId=1&refresh=10s&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}&var-job=All&var-pod=All&var-interval=5m
        message: 'High error budget burn for group=metricsv1,handler=query_range,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapimetricserrorsslobudgetburn30mand6h
      expr: |
        sum(http_requests_total:burnrate30m{handler="query_range",job="observatorium-observatorium-api"}) > (6.00 * (1-0.90000))
        and
        sum(http_requests_total:burnrate6h{handler="query_range",job="observatorium-observatorium-api"}) > (6.00 * (1-0.90000))
      for: 15m
      labels:
        handler: query_range
        job: observatorium-observatorium-api
        service: telemeter
        severity: critical
    - alert: ObservatoriumAPIMetricsErrorsSLOBudgetBurn2hand1d
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Tg-mH0rizaSJDKSADX/observatorium-api-query-range-metrics-errors.slo?orgId=1&refresh=10s&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}&var-job=All&var-pod=All&var-interval=5m
        message: 'High error budget burn for group=metricsv1,handler=query_range,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapimetricserrorsslobudgetburn2hand1d
      expr: |
        sum(http_requests_total:burnrate2h{handler="query_range",job="observatorium-observatorium-api"}) > (3.00 * (1-0.90000))
        and
        sum(http_requests_total:burnrate1d{handler="query_range",job="observatorium-observatorium-api"}) > (3.00 * (1-0.90000))
      for: 1h
      labels:
        handler: query_range
        job: observatorium-observatorium-api
        service: telemeter
        severity: medium
    - alert: ObservatoriumAPIMetricsErrorsSLOBudgetBurn6hand3d
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Tg-mH0rizaSJDKSADX/observatorium-api-query-range-metrics-errors.slo?orgId=1&refresh=10s&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}&var-job=All&var-pod=All&var-interval=5m
        message: 'High error budget burn for group=metricsv1,handler=query_range,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapimetricserrorsslobudgetburn6hand3d
      expr: |
        sum(http_requests_total:burnrate6h{handler="query_range",job="observatorium-observatorium-api"}) > (1.00 * (1-0.90000))
        and
        sum(http_requests_total:burnrate3d{handler="query_range",job="observatorium-observatorium-api"}) > (1.00 * (1-0.90000))
      for: 3h
      labels:
        handler: query_range
        job: observatorium-observatorium-api
        service: telemeter
        severity: medium
  - name: observatorium-api-push-logs-errors.slo
    rules:
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="push",job="observatorium-observatorium-api",code=~"5.."}[1d]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="push",job="observatorium-observatorium-api"}[1d]))
      labels:
        handler: push
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate1d
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="push",job="observatorium-observatorium-api",code=~"5.."}[1h]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="push",job="observatorium-observatorium-api"}[1h]))
      labels:
        handler: push
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate1h
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="push",job="observatorium-observatorium-api",code=~"5.."}[2h]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="push",job="observatorium-observatorium-api"}[2h]))
      labels:
        handler: push
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate2h
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="push",job="observatorium-observatorium-api",code=~"5.."}[30m]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="push",job="observatorium-observatorium-api"}[30m]))
      labels:
        handler: push
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate30m
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="push",job="observatorium-observatorium-api",code=~"5.."}[3d]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="push",job="observatorium-observatorium-api"}[3d]))
      labels:
        handler: push
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate3d
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="push",job="observatorium-observatorium-api",code=~"5.."}[5m]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="push",job="observatorium-observatorium-api"}[5m]))
      labels:
        handler: push
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate5m
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="push",job="observatorium-observatorium-api",code=~"5.."}[6h]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="push",job="observatorium-observatorium-api"}[6h]))
      labels:
        handler: push
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate6h
    - alert: ObservatoriumAPILogsErrorsSLOBudgetBurn5mand1h
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Lg-mH0rizaSJDKSADX/api-logs?orgId=1&refresh=1m&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}
        message: 'High error budget burn for group=logsv1,handler=push,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapilogserrorsslobudgetburn5mand1h
      expr: |
        sum(http_requests_total:burnrate5m{group="logsv1",handler="push",job="observatorium-observatorium-api"}) > (14.40 * (1-0.90000))
        and
        sum(http_requests_total:burnrate1h{group="logsv1",handler="push",job="observatorium-observatorium-api"}) > (14.40 * (1-0.90000))
      for: 2m
      labels:
        handler: push
        job: observatorium-observatorium-api
        service: observatorium-logs
        severity: critical
    - alert: ObservatoriumAPILogsErrorsSLOBudgetBurn30mand6h
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Lg-mH0rizaSJDKSADX/api-logs?orgId=1&refresh=1m&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}
        message: 'High error budget burn for group=logsv1,handler=push,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapilogserrorsslobudgetburn30mand6h
      expr: |
        sum(http_requests_total:burnrate30m{group="logsv1",handler="push",job="observatorium-observatorium-api"}) > (6.00 * (1-0.90000))
        and
        sum(http_requests_total:burnrate6h{group="logsv1",handler="push",job="observatorium-observatorium-api"}) > (6.00 * (1-0.90000))
      for: 15m
      labels:
        handler: push
        job: observatorium-observatorium-api
        service: observatorium-logs
        severity: critical
    - alert: ObservatoriumAPILogsErrorsSLOBudgetBurn2hand1d
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Lg-mH0rizaSJDKSADX/api-logs?orgId=1&refresh=1m&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}
        message: 'High error budget burn for group=logsv1,handler=push,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapilogserrorsslobudgetburn2hand1d
      expr: |
        sum(http_requests_total:burnrate2h{group="logsv1",handler="push",job="observatorium-observatorium-api"}) > (3.00 * (1-0.90000))
        and
        sum(http_requests_total:burnrate1d{group="logsv1",handler="push",job="observatorium-observatorium-api"}) > (3.00 * (1-0.90000))
      for: 1h
      labels:
        handler: push
        job: observatorium-observatorium-api
        service: observatorium-logs
        severity: medium
    - alert: ObservatoriumAPILogsErrorsSLOBudgetBurn6hand3d
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Lg-mH0rizaSJDKSADX/api-logs?orgId=1&refresh=1m&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}
        message: 'High error budget burn for group=logsv1,handler=push,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapilogserrorsslobudgetburn6hand3d
      expr: |
        sum(http_requests_total:burnrate6h{group="logsv1",handler="push",job="observatorium-observatorium-api"}) > (1.00 * (1-0.90000))
        and
        sum(http_requests_total:burnrate3d{group="logsv1",handler="push",job="observatorium-observatorium-api"}) > (1.00 * (1-0.90000))
      for: 3h
      labels:
        handler: push
        job: observatorium-observatorium-api
        service: observatorium-logs
        severity: medium
  - name: observatorium-api-query-logs-errors.slo
    rules:
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api",code=~"5.."}[1d]))
        /
        sum(rate(http_requests_total{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api"}[1d]))
      labels:
        handler: query|label|labels|label_values
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate1d
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api",code=~"5.."}[1h]))
        /
        sum(rate(http_requests_total{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api"}[1h]))
      labels:
        handler: query|label|labels|label_values
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate1h
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api",code=~"5.."}[2h]))
        /
        sum(rate(http_requests_total{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api"}[2h]))
      labels:
        handler: query|label|labels|label_values
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate2h
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api",code=~"5.."}[30m]))
        /
        sum(rate(http_requests_total{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api"}[30m]))
      labels:
        handler: query|label|labels|label_values
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate30m
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api",code=~"5.."}[3d]))
        /
        sum(rate(http_requests_total{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api"}[3d]))
      labels:
        handler: query|label|labels|label_values
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate3d
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api",code=~"5.."}[5m]))
        /
        sum(rate(http_requests_total{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api"}[5m]))
      labels:
        handler: query|label|labels|label_values
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate5m
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api",code=~"5.."}[6h]))
        /
        sum(rate(http_requests_total{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api"}[6h]))
      labels:
        handler: query|label|labels|label_values
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate6h
    - alert: ObservatoriumAPILogsErrorsSLOBudgetBurn5mand1h
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Lg-mH0rizaSJDKSADX/api-logs?orgId=1&refresh=1m&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}
        message: 'High error budget burn for group=logsv1,handler=~query|label|labels|label_values,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapilogserrorsslobudgetburn5mand1h
      expr: |
        sum(http_requests_total:burnrate5m{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api"}) > (14.40 * (1-0.90000))
        and
        sum(http_requests_total:burnrate1h{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api"}) > (14.40 * (1-0.90000))
      for: 2m
      labels:
        handler: query|label|labels|label_values
        job: observatorium-observatorium-api
        service: observatorium-logs
        severity: critical
    - alert: ObservatoriumAPILogsErrorsSLOBudgetBurn30mand6h
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Lg-mH0rizaSJDKSADX/api-logs?orgId=1&refresh=1m&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}
        message: 'High error budget burn for group=logsv1,handler=~query|label|labels|label_values,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapilogserrorsslobudgetburn30mand6h
      expr: |
        sum(http_requests_total:burnrate30m{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api"}) > (6.00 * (1-0.90000))
        and
        sum(http_requests_total:burnrate6h{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api"}) > (6.00 * (1-0.90000))
      for: 15m
      labels:
        handler: query|label|labels|label_values
        job: observatorium-observatorium-api
        service: observatorium-logs
        severity: critical
    - alert: ObservatoriumAPILogsErrorsSLOBudgetBurn2hand1d
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Lg-mH0rizaSJDKSADX/api-logs?orgId=1&refresh=1m&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}
        message: 'High error budget burn for group=logsv1,handler=~query|label|labels|label_values,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapilogserrorsslobudgetburn2hand1d
      expr: |
        sum(http_requests_total:burnrate2h{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api"}) > (3.00 * (1-0.90000))
        and
        sum(http_requests_total:burnrate1d{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api"}) > (3.00 * (1-0.90000))
      for: 1h
      labels:
        handler: query|label|labels|label_values
        job: observatorium-observatorium-api
        service: observatorium-logs
        severity: medium
    - alert: ObservatoriumAPILogsErrorsSLOBudgetBurn6hand3d
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Lg-mH0rizaSJDKSADX/api-logs?orgId=1&refresh=1m&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}
        message: 'High error budget burn for group=logsv1,handler=~query|label|labels|label_values,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapilogserrorsslobudgetburn6hand3d
      expr: |
        sum(http_requests_total:burnrate6h{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api"}) > (1.00 * (1-0.90000))
        and
        sum(http_requests_total:burnrate3d{group="logsv1",handler=~"query|label|labels|label_values",job="observatorium-observatorium-api"}) > (1.00 * (1-0.90000))
      for: 3h
      labels:
        handler: query|label|labels|label_values
        job: observatorium-observatorium-api
        service: observatorium-logs
        severity: medium
  - name: observatorium-api-query-range-logs-errors.slo
    rules:
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="query_range",job="observatorium-observatorium-api",code=~"5.."}[1d]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="query_range",job="observatorium-observatorium-api"}[1d]))
      labels:
        handler: query_range
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate1d
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="query_range",job="observatorium-observatorium-api",code=~"5.."}[1h]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="query_range",job="observatorium-observatorium-api"}[1h]))
      labels:
        handler: query_range
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate1h
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="query_range",job="observatorium-observatorium-api",code=~"5.."}[2h]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="query_range",job="observatorium-observatorium-api"}[2h]))
      labels:
        handler: query_range
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate2h
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="query_range",job="observatorium-observatorium-api",code=~"5.."}[30m]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="query_range",job="observatorium-observatorium-api"}[30m]))
      labels:
        handler: query_range
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate30m
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="query_range",job="observatorium-observatorium-api",code=~"5.."}[3d]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="query_range",job="observatorium-observatorium-api"}[3d]))
      labels:
        handler: query_range
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate3d
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="query_range",job="observatorium-observatorium-api",code=~"5.."}[5m]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="query_range",job="observatorium-observatorium-api"}[5m]))
      labels:
        handler: query_range
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate5m
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="query_range",job="observatorium-observatorium-api",code=~"5.."}[6h]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="query_range",job="observatorium-observatorium-api"}[6h]))
      labels:
        handler: query_range
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate6h
    - alert: ObservatoriumAPILogsErrorsSLOBudgetBurn5mand1h
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Lg-mH0rizaSJDKSADX/api-logs?orgId=1&refresh=1m&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}
        message: 'High error budget burn for group=logsv1,handler=query_range,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapilogserrorsslobudgetburn5mand1h
      expr: |
        sum(http_requests_total:burnrate5m{group="logsv1",handler="query_range",job="observatorium-observatorium-api"}) > (14.40 * (1-0.90000))
        and
        sum(http_requests_total:burnrate1h{group="logsv1",handler="query_range",job="observatorium-observatorium-api"}) > (14.40 * (1-0.90000))
      for: 2m
      labels:
        handler: query_range
        job: observatorium-observatorium-api
        service: observatorium-logs
        severity: critical
    - alert: ObservatoriumAPILogsErrorsSLOBudgetBurn30mand6h
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Lg-mH0rizaSJDKSADX/api-logs?orgId=1&refresh=1m&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}
        message: 'High error budget burn for group=logsv1,handler=query_range,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapilogserrorsslobudgetburn30mand6h
      expr: |
        sum(http_requests_total:burnrate30m{group="logsv1",handler="query_range",job="observatorium-observatorium-api"}) > (6.00 * (1-0.90000))
        and
        sum(http_requests_total:burnrate6h{group="logsv1",handler="query_range",job="observatorium-observatorium-api"}) > (6.00 * (1-0.90000))
      for: 15m
      labels:
        handler: query_range
        job: observatorium-observatorium-api
        service: observatorium-logs
        severity: critical
    - alert: ObservatoriumAPILogsErrorsSLOBudgetBurn2hand1d
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Lg-mH0rizaSJDKSADX/api-logs?orgId=1&refresh=1m&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}
        message: 'High error budget burn for group=logsv1,handler=query_range,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapilogserrorsslobudgetburn2hand1d
      expr: |
        sum(http_requests_total:burnrate2h{group="logsv1",handler="query_range",job="observatorium-observatorium-api"}) > (3.00 * (1-0.90000))
        and
        sum(http_requests_total:burnrate1d{group="logsv1",handler="query_range",job="observatorium-observatorium-api"}) > (3.00 * (1-0.90000))
      for: 1h
      labels:
        handler: query_range
        job: observatorium-observatorium-api
        service: observatorium-logs
        severity: medium
    - alert: ObservatoriumAPILogsErrorsSLOBudgetBurn6hand3d
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Lg-mH0rizaSJDKSADX/api-logs?orgId=1&refresh=1m&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}
        message: 'High error budget burn for group=logsv1,handler=query_range,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapilogserrorsslobudgetburn6hand3d
      expr: |
        sum(http_requests_total:burnrate6h{group="logsv1",handler="query_range",job="observatorium-observatorium-api"}) > (1.00 * (1-0.90000))
        and
        sum(http_requests_total:burnrate3d{group="logsv1",handler="query_range",job="observatorium-observatorium-api"}) > (1.00 * (1-0.90000))
      for: 3h
      labels:
        handler: query_range
        job: observatorium-observatorium-api
        service: observatorium-logs
        severity: medium
  - name: observatorium-api-tail-logs-errors.slo
    rules:
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api",code=~"5.."}[1d]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api"}[1d]))
      labels:
        handler: tail|prom_tail
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate1d
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api",code=~"5.."}[1h]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api"}[1h]))
      labels:
        handler: tail|prom_tail
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate1h
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api",code=~"5.."}[2h]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api"}[2h]))
      labels:
        handler: tail|prom_tail
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate2h
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api",code=~"5.."}[30m]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api"}[30m]))
      labels:
        handler: tail|prom_tail
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate30m
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api",code=~"5.."}[3d]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api"}[3d]))
      labels:
        handler: tail|prom_tail
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate3d
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api",code=~"5.."}[5m]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api"}[5m]))
      labels:
        handler: tail|prom_tail
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate5m
    - expr: |
        sum(rate(http_requests_total{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api",code=~"5.."}[6h]))
        /
        sum(rate(http_requests_total{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api"}[6h]))
      labels:
        handler: tail|prom_tail
        job: observatorium-observatorium-api
      record: http_requests_total:burnrate6h
    - alert: ObservatoriumAPILogsErrorsSLOBudgetBurn5mand1h
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Lg-mH0rizaSJDKSADX/api-logs?orgId=1&refresh=1m&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}
        message: 'High error budget burn for group=logsv1,handler=tail|prom_tail,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapilogserrorsslobudgetburn5mand1h
      expr: |
        sum(http_requests_total:burnrate5m{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api"}) > (14.40 * (1-0.90000))
        and
        sum(http_requests_total:burnrate1h{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api"}) > (14.40 * (1-0.90000))
      for: 2m
      labels:
        handler: tail|prom_tail
        job: observatorium-observatorium-api
        service: observatorium-logs
        severity: critical
    - alert: ObservatoriumAPILogsErrorsSLOBudgetBurn30mand6h
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Lg-mH0rizaSJDKSADX/api-logs?orgId=1&refresh=1m&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}
        message: 'High error budget burn for group=logsv1,handler=tail|prom_tail,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapilogserrorsslobudgetburn30mand6h
      expr: |
        sum(http_requests_total:burnrate30m{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api"}) > (6.00 * (1-0.90000))
        and
        sum(http_requests_total:burnrate6h{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api"}) > (6.00 * (1-0.90000))
      for: 15m
      labels:
        handler: tail|prom_tail
        job: observatorium-observatorium-api
        service: observatorium-logs
        severity: critical
    - alert: ObservatoriumAPILogsErrorsSLOBudgetBurn2hand1d
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Lg-mH0rizaSJDKSADX/api-logs?orgId=1&refresh=1m&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}
        message: 'High error budget burn for group=logsv1,handler=tail|prom_tail,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapilogserrorsslobudgetburn2hand1d
      expr: |
        sum(http_requests_total:burnrate2h{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api"}) > (3.00 * (1-0.90000))
        and
        sum(http_requests_total:burnrate1d{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api"}) > (3.00 * (1-0.90000))
      for: 1h
      labels:
        handler: tail|prom_tail
        job: observatorium-observatorium-api
        service: observatorium-logs
        severity: medium
    - alert: ObservatoriumAPILogsErrorsSLOBudgetBurn6hand3d
      annotations:
        dashboard: https://grafana.app-sre.devshift.net/d/Lg-mH0rizaSJDKSADX/api-logs?orgId=1&refresh=1m&var-datasource=telemeter-prod-01-prometheus&var-namespace={{$labels.namespace}}
        message: 'High error budget burn for group=logsv1,handler=tail|prom_tail,job=observatorium-observatorium-api (current value: {{ $value }})'
        runbook: https://github.com/rhobs/configuration/blob/main/docs/sop/observatorium.md#observatoriumapilogserrorsslobudgetburn6hand3d
      expr: |
        sum(http_requests_total:burnrate6h{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api"}) > (1.00 * (1-0.90000))
        and
        sum(http_requests_total:burnrate3d{group="logsv1",handler="tail|prom_tail",job="observatorium-observatorium-api"}) > (1.00 * (1-0.90000))
      for: 3h
      labels:
        handler: tail|prom_tail
        job: observatorium-observatorium-api
        service: observatorium-logs
        severity: medium
